$(function () {
    filesManage.initFiles();
});
var filesManage = {
    initFiles: function () {
        $.post("/Com/Upload/GetAllFileData", { fileExt: $("#fileExt").val() }, function (res) {
            if (res.Status == "y") {
                if (res.Data == "" || res.Data == null) {
                    $("#filesPanel").html('<div class="alert alert-warning text-center"><span style="font-size:16px;"><i class="fa fa-warning"></i>&nbsp;沒有找到任何檔</span></div>');
                } else {
                    $("#filesPanel").empty();
                    $("#tlist").tmpl(res.Data).appendTo('#filesPanel');
                    $(".file-box").each(function () { animationHover(this, "pulse") });
                    //初始化CheckBox
                    $(".icheck_box").iCheck({
                        checkboxClass: 'icheckbox_flat-red',
                        radioClass: 'iradio_flat-red',
                        increaseArea: '20%' // optional
                    });
                    //點擊選中/取消
                    $(".checkselected").click(function () {
                        if ($(this).parent().next().find('input[name="check_files"]').prop("checked")) {
                            $(this).parent().next().find('input[name="check_files"]').iCheck("uncheck");
                        }
                        else {
                            $(this).parent().next().find('input[name="check_files"]').iCheck("check");
                        }
                    });
                }
            }
            else {
                dig.error(res.Msg);
            }
        }, "json");
    },
    delFiles: function (n) {
        dig.confirm("刪除確認", "刪除後不可恢復,確定刪除嗎？", function () {
            $.post("/Com/Upload/DeleteBy", { path: n }, function (res) {
                if (res.Status == "y")
                    location.reload();
                else {
                    dig.error(res.Msg);
                }
            }, "json");
        });
    },
    delMoreFiles: function () {
        var vals = '';
        $('input[name="check_files"]:checked').each(function () {
            vals += $(this).val() + ';';
        });
        if (vals == '' || vals == ';') {
            dig.error("對不起，請選中您要操作的檔！");
            return;
        }
        dig.confirm("刪除確認", "刪除後不可恢復,確定刪除嗎？", function () {
            $.post("/Com/Upload/DeleteBy", { path: vals }, function (res) {
                if (res.Status == "y")
                    location.reload();
                else {
                    dig.error(res.Msg);
                }
            }, "json");
        });
    },
    showFilePath: function (n) {
        dig.msg("", "檔目錄：" + n);
    },
    copyFiles: function () {
        var vals = '';
        $('input[name="check_files"]:checked').each(function () {
            vals += $(this).val() + ';';
        });
        if (vals == '' || vals == ';') {
            dig.error("對不起，請選中您要操作的檔！");
            return;
        }
        dig.fileOperation('', vals, "/Com/Upload/Copy", function () {
            if (this.returnValue == 'yes') {
                location.reload();
            }
        });
    },
    moveFiles: function () {
        var vals = '';
        $('input[name="check_files"]:checked').each(function () {
            vals += $(this).val() + ';';
        });
        if (vals == '' || vals == ';') {
            dig.error("對不起，請選中您要操作的檔！");
            return;
        }
        dig.fileOperation('', vals, "/Com/Upload/Cut", function () {
            if (this.returnValue == 'yes') {
                location.reload();
            }
        });
    },
    compressFiles: function () {
        var vals = '';
        $('input[name="check_files"]:checked').each(function () {
            vals += $(this).val() + ';';
        });
        if (vals == '' || vals == ';') {
            dig.error("對不起，請選中您要操作的檔！");
            return;
        }
        dig.fileOperation('', vals, "/Com/Upload/Compress", function () {
            if (this.returnValue == 'yes') {
                location.reload();
            }
        });
    },
    expandFiles: function () {
        var vals = '';
        var num = 0;
        $('input[name="check_files"]:checked').each(function () {
            vals = $(this).val();
            num++;
        });
        if (!vals) {
            dig.error("對不起，請選中您要操作的檔！");
            return;
        }
        if (num > 1) {
            dig.error("對不起，每次只能操作一個檔！");
            return;
        }
        if (vals.substring(vals.lastIndexOf('.'), vals.length) != ".zip") {
            dig.error("只能解壓ZIP格式檔！");
            return;
        }
        dig.fileOperation('', vals, "/Com/Upload/Expand", function () {
            if (this.returnValue == 'yes') {
                location.reload();
            }
        });
    }
};
function animationHover(o, e) {
    o = $(o), o.hover(function () {
        o.addClass("animated " + e)
    }, function () {
        window.setTimeout(function () {
            o.removeClass("animated " + e)
        }, 2e3)
    })
}

